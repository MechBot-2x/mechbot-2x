jobs:
  contribution:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      pull-requests: write
    steps:
      # Configuración de entornos
      - name: Setup Node.js
        uses: actions/setup-node@v4.3.0
        with:
          node-version: '20'
          cache: 'npm'
          cache-dependency-path: '**/package-lock.json'

      - name: Setup .NET Core
        uses: actions/setup-dotnet@v4.3.1
        with:
          dotnet-version: '6.0.x'
          cache: true

      # Caché inteligente
      - name: Cache dependencies
        uses: actions/cache@v4.2.3
        with:
          path: |
            ~/.npm
            ~/.nuget/packages
            src/bin
          key: ${{ runner.os }}-build-${{ hashFiles('**/package-lock.json', '**/*.csproj') }}
          restore-keys: |
            ${{ runner.os }}-build-

      # Manejo de contribuyentes
      - name: First Interaction
        uses: actions/first-interaction@v1.3.0
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          pr-message: |
            🤖 ¡Bienvenido al equipo MechBot 2.0x!
            **Checklist de revisión**:
            - [ ] Validación OBD-II (Ejecutar `tests/obd_test.py`)
            - [ ] Compatibilidad CAN FD (Verificar [Anexo A](AnexoA_Especificaciones_MechBot2.0x.md))
            📅 Tiempo estimado de revisión: 48h
          issue-message: |
            🚗 Issue detectado - Equipo asignado:
            - @mechbot-ia-team (Para fallos de modelos ML)
            - @mechbot-firmware (Para problemas CAN/OBD)

      # Build y Artifacts
      - name: Build artifacts
        run: |
          npm run build
          dotnet publish -c Release -o artifacts
          
      - name: Upload artifacts
        uses: actions/upload-artifact@v4.6.2
        with:
          name: build-output
          path: |
            dist/
            artifacts/
            coverage.xml
          retention-days: 7
          compression-level: 6

# **MechBot 2.0x - Estructura del Proyecto y Pipeline CI/CD**  

## **ğŸ”§ Pipeline CI/CD Optimizado**  

```yaml
name: Pipeline CI/CD de MechBot 2.0x
on:
  push:
    branches: [main, dev]
    tags: ['v*.*.*']  # Ej: v1.2.3
  pull_request:
    branches: ['*']

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true  # Evita ejecuciones duplicadas

jobs:
  control-calidad:
    name: Puerta de Calidad
    runs-on: ubuntu-22.04
    timeout-minutes: 15  # Fallo rÃ¡pido si hay bloqueos

    steps:
      - name: Obtener cÃ³digo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Necesario para anÃ¡lisis de cÃ³digo
          submodules: recursive  # Para dependencias embebidas

      - name: Configurar Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
          cache: 'pip'  # Acelera builds futuros
          cache-dependency-path: '**/requirements.txt'

      - name: Instalar dependencias
        run: |
          pip install --upgrade pip wheel
          pip install -e .[test,security]  # Dependencias de testeo
          pip install ruff==0.3.7 mypy==1.8.0  # Linters estÃ¡ticos

      - name: Configurar entorno
        run: |
          cp env.sample .env  # Variables de entorno para testing
          echo "MODE=ci" >> .env
          echo "PYTHONPATH=$GITHUB_WORKSPACE" >> $GITHUB_ENV

      - name: AnÃ¡lisis estÃ¡tico
        run: |
          echo "=== VerificaciÃ³n con Ruff ==="
          ruff check --config=pyproject.toml src/ tests/
          
          echo "=== VerificaciÃ³n de tipos con MyPy ==="
          mypy --config-file=pyproject.toml src/

      - name: Pruebas unitarias
        run: |
          pytest \
            --cov=src \          # Genera informe de cobertura
            --cov-report=xml \    # Para SonarQube
            --cov-report=term \   # Muestra resultados en consola
            --durations=10 \      # Identifica pruebas lentas
            tests/unit/

      - name: Escaneo de seguridad
        run: |
          pip install safety
          safety check --full-report  # Detecta dependencias vulnerables
          bandit -r src/             # AnÃ¡lisis de cÃ³digo inseguro

      - name: Subir mÃ©tricas de cobertura
        uses: codecov/codecov-action@v3
        with:
          fail_ci_if_error: true  # Falla si la cobertura es insuficiente

  pruebas-integraciÃ³n:
    name: Suite de IntegraciÃ³n
    needs: control-calidad  # Depende del job anterior
    runs-on: ubuntu-22.04
    
    services:
      postgres:  # Base de datos para testing
        image: postgres:14
        env:
          POSTGRES_PASSWORD: test
        ports:
          - 5432:5432
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5

    steps:
      - uses: actions/checkout@v4
      - run: |
          docker-compose -f docker-compose.test.yml up -d
          pytest tests/integration  # Pruebas con servicios reales
```

---

## **ğŸ—ï¸ Estructura del Proyecto (Mejorada)**  

```bash
mechbot-2x/
â”œâ”€â”€ ğŸ“ .github/
â”‚   â””â”€â”€ ğŸ“ workflows/
â”‚       â”œâ”€â”€ ci-cd.yml            # Pipeline CI/CD principal
â”‚       â””â”€â”€ release.yml          # Despliegues automÃ¡ticos
â”‚
â”œâ”€â”€ ğŸ“ backend/
â”‚   â”œâ”€â”€ ğŸ“ auth/                 # AutenticaciÃ³n Zero-Trust
â”‚   â”‚   â”œâ”€â”€ jwt_manager.py       # JWT con HS512 + Kyber (PQC)
â”‚   â”‚   â””â”€â”€ oauth_schemas.py     # Modelos Pydantic v2
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ diagnosis/            # NÃºcleo de IA
â”‚   â”‚   â”œâ”€â”€ ml_models/           # Modelos ONNX optimizados
â”‚   â”‚   â”‚   â”œâ”€â”€ xgboost-v3.onnx  # Para diagnÃ³stico rÃ¡pido
â”‚   â”‚   â”‚   â””â”€â”€ bert-multi.onnx  # AnÃ¡lisis multilingÃ¼e
â”‚   â”‚   â””â”€â”€ realtime_processing/ # Procesamiento en tiempo real
â”‚   â”‚       â”œâ”€â”€ spark_stream.py  # IntegraciÃ³n con Kafka
â”‚   â”‚       â””â”€â”€ fault_codes.db   # Base de datos de cÃ³digos de error (SAE J2012)
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ workshop-integration/ # ConexiÃ³n con talleres
â”‚       â”œâ”€â”€ protos/              # Definiciones gRPC (.proto)
â”‚       â”‚   â””â”€â”€ diagnosis.proto
â”‚       â””â”€â”€ salesforce_adapter/  # IntegraciÃ³n con CRM
â”‚           â””â”€â”€ soql_queries.json
â”‚
â”œâ”€â”€ ğŸ“ frontend/
â”‚   â”œâ”€â”€ ğŸ“ public/               # Assets estÃ¡ticos
â”‚   â”‚   â””â”€â”€ models/             # Modelos 3D (GLTF comprimido)
â”‚   â”‚       â”œâ”€â”€ engine.glb       # Motor interactivo
â”‚   â”‚       â””â”€â”€ transmission.glb # TransmisiÃ³n en 3D
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ src/
â”‚   â”‚   â”œâ”€â”€ hooks/              # Hooks personalizados de React
â”‚   â”‚   â”‚   â””â”€â”€ useTelemetry.js # GestiÃ³n de WebSockets
â”‚   â”‚   â””â”€â”€ components/AR/      # Componentes de Realidad Aumentada
â”‚   â”‚       â”œâ”€â”€ EngineViewer.js # Renderizado WebGL
â”‚   â”‚       â””â”€â”€ FaultOverlay.js # Anotaciones 3D interactivas
â”‚   â”‚
â”‚   â””â”€â”€ next.config.js          # ConfiguraciÃ³n SSR/ISR
â”‚
â”œâ”€â”€ ğŸ“ infrastructure/
â”‚   â”œâ”€â”€ ğŸ“ k8s/                 # ConfiguraciÃ³n Kubernetes
â”‚   â”‚   â”œâ”€â”€ values-prod.yaml    # Autoescalado (HPA)
â”‚   â”‚   â””â”€â”€ istio-gateway.yaml  # GestiÃ³n de trÃ¡fico
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ terraform/           # Infraestructura como CÃ³digo
â”‚   â”‚   â”œâ”€â”€ modules/eks/        # Cluster AWS EKS
â”‚   â”‚   â””â”€â”€ monitoring/         # Alertas de Prometheus
â”‚   â”‚
â”‚   â””â”€â”€ docker-compose.yml      # Entorno de desarrollo local
â”‚
â”œâ”€â”€ ğŸ“ tests/
â”‚   â”œâ”€â”€ e2e/                    # Pruebas End-to-End
â”‚   â”‚   â””â”€â”€ diagnosis-flow.spec.js  # Flujo de diagnÃ³stico con Playwright
â”‚   â”œâ”€â”€ integration/            # Pruebas de integraciÃ³n
â”‚   â”‚   â””â”€â”€ test_grpc_service.py    # gRPC + PostgreSQL
â”‚   â””â”€â”€ unit/                   # Pruebas unitarias
â”‚       â””â”€â”€ test_jwt_manager.py  # 100% cobertura
â”‚
â”œâ”€â”€ ğŸ“ scripts/
â”‚   â”œâ”€â”€ data-pipeline/          # ETL con AWS Glue
â”‚   â”‚   â””â”€â”€ transform_obd.py    # Procesamiento de datos OBD-II
â”‚   â””â”€â”€ security/              # AuditorÃ­as de seguridad
â”‚       â””â”€â”€ cis_scan.sh         # Escaneo diario CIS Benchmark
â”‚
â”œâ”€â”€ .env.sample                 # Plantilla de variables de entorno
â”œâ”€â”€ Makefile                    # Comandos automatizados
â””â”€â”€ pyproject.toml              # ConfiguraciÃ³n PEP-621
```

---

## **ğŸ” Detalles TÃ©cnicos Clave**  

### **âš™ï¸ ConfiguraciÃ³n de Seguridad**  
```python
# pyproject.toml
[tool.bandit]
exclude_dirs = ["legacy"]  # Ignorar cÃ³digo heredado
targets = ["src"]          # Escanear solo cÃ³digo fuente
skips = ["B101"]           # Permitir 'assert' en tests

[tool.ruff]
line-length = 120          # MÃ¡ximo de caracteres por lÃ­nea
select = ["E", "F", "B"]   # Habilitar reglas clave
ignore = ["E501"]          # Ignorar lÃ­mite de lÃ­nea (ya gestionado por Black)
```

### **ğŸš€ OptimizaciÃ³n para ProducciÃ³n**  
```dockerfile
# backend/Dockerfile (Optimizado para GPU)
FROM python:3.10-slim as builder
RUN pip install --user onnxruntime-gpu==1.16.0  # Soporte CUDA

FROM nvidia/cuda:12.2-base
COPY --from=builder /root/.local /usr/local
ENV LD_LIBRARY_PATH=/usr/local/cuda/lib64  # Soporte NVIDIA
```

### **ğŸ“Š MÃ©tricas de Calidad**  
| Ãrea          | Herramienta    | Objetivo               |
|---------------|---------------|------------------------|
| **CÃ³digo**    | SonarQube     | <5% deuda tÃ©cnica      |
| **Seguridad** | Trivy + Bandit| 0 vulnerabilidades crÃ­ticas |
| **Rendimiento**| k6            | p95 < 2 segundos       |
| **DocumentaciÃ³n** | Vale       | 100% cobertura         |

---

## **ğŸš€ Workflow de Desarrollo**  
```mermaid
graph LR
    A[Issue en GitHub] --> B[Rama semÃ¡ntica]
    B --> C[Pre-commit: Ruff + MyPy]
    C --> D[CI: Build + Tests]
    D -->|âœ…| E[Despliegue en Dev]
    E --> F[QA Automatizado]
    F -->|Aprobado| G[PromociÃ³n a ProducciÃ³n]
```

**Equipo MechBot 2.0x**  
[![Licencia](https://img.shields.io/badge/Licencia-Apache_2.0-blue.svg)](LICENSE)  
*Ãšltima actualizaciÃ³n: 20/11/2023*  

ğŸ“Œ **Â¿Preguntas?** Abre un *issue* en [GitHub](https://github.com/mechbot-2x).

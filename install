#!/bin/bash
# Script de instalación robusto para MechBot 2.0x

echo "🔧 Instalando MechBot 2.0x..."

# Verificar Python
if ! command -v python3 &> /dev/null; then
    echo "❌ Python 3 no está instalado"
    exit 1
fi

# Crear entorno virtual
echo "📦 Creando entorno virtual..."
python3 -m venv venv

# Activar entorno virtual
echo "🔧 Activando entorno virtual..."
source venv/bin/activate

# Verificar que estamos en el entorno virtual
if [[ "$VIRTUAL_ENV" == "" ]]; then
    echo "❌ No se pudo activar el entorno virtual"
    exit 1
fi

# Instalar pip actualizado
echo "🔄 Actualizando pip..."
pip install --upgrade pip

# Instalar dependencias
echo "📦 Instalando dependencias..."
pip install fastapi==0.104.1 uvicorn==0.24.0 python-jose==3.3.0

# Instalar el resto de dependencias
if [ -f "requirements.txt" ]; then
    pip install -r requirements.txt
else
    echo "⚠️  requirements.txt no encontrado, instalando dependencias básicas..."
    pip install pydantic python-dotenv requests numpy pandas
fi

echo "✅ Instalación completada!"
echo "🚀 Para ejecutar: source venv/bin/activate && uvicorn api.main:app --reload"
